{% extends 'base.html' %}
{% block title %}Asignaciones Moto - LogiCo{% endblock %}

{% block content %}
<div class="page-title d-flex justify-content-between align-items-center">
    <h1><i class="bi bi-link-45deg"></i> Asignaciones Moto</h1>
    {% if puede_crear %}
    <a href="{% url 'asignacion_moto_crear' %}" class="btn btn-primary"><i class="bi bi-plus-circle"></i> Nueva Asignación</a>
    {% endif %}
</div>

<!-- Filtros -->
<div class="card mb-3">
    <div class="card-body">
        <form method="get" class="row g-3">
          <div class="col-md-2">
                <label class="form-label">ID único</label>
                <input type="text" name="id_motorista" value="{{ request.GET.id_motorista }}" class="form-control" placeholder="ID único">
            </div>
            <div class="col-md-2">
                <label class="form-label">Motorista</label>
                <input type="text" name="motorista" value="{{ request.GET.motorista }}" class="form-control" placeholder="Motorista (nombre, apellido, rut o ID único)">
            </div>
            <div class="col-md-2">
                <label class="form-label">ID único</label>
                <input type="text" name="id_moto" value="{{ request.GET.id_moto }}" class="form-control" placeholder="ID único">
            </div>
            <div class="col-md-2">
                <label class="form-label">Moto</label>
                <input type="text" name="moto" value="{{ request.GET.moto }}" class="form-control" placeholder="Moto (patente, marca, modelo, ID único)">
            </div>
            <div class="col-md-2">
                <label class="form-label">Fecha asignación</label>
                <input type="date" name="fecha_asignacion" value="{{ request.GET.fecha_asignacion }}" class="form-control">
            </div>
            <div class="col-md-2">
                <label class="form-label">Fecha desasignación</label>
                <input type="date" name="fecha_desasignacion" value="{{ request.GET.fecha_desasignacion }}" class="form-control">
            </div>
            <div class="col-md-2">
              <label class="form-label">Activa</label>
                <select name="activa" class="form-select">
                    <option value="">Todas</option>
                    <option value="true"{% if request.GET.activa == "true" %} selected{% endif %}>Solo activas</option>
                    <option value="false"{% if request.GET.activa == "false" %} selected{% endif %}>Solo inactivas</option>
                </select>
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-primary btn-sm">
                  <i class="bi bi-search"></i> Filtrar
              </button>
              <a href="{% url 'asignacion_moto_listar' %}" class="btn btn-secondary btn-sm">
                  <i class="bi bi-x-circle"></i> Limpiar
                </a>
            </div>
        </form>
    </div>
</div>

<div class="card">
  <div class="table-responsive">
    <table class="table table-hover">
      <thead>
        <tr>
          <th>ID</th>
          <th>Motorista</th>
          <th>ID</th>
          <th>Moto</th>
          <th>Fecha Asignación</th>
          <th>Fecha Desasignación</th>
          <th>Activa</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for a in page_obj %}
        <tr>
          <td>{{ a.motorista.identificador_unico }}</td>
          <td>{{ a.motorista.usuario.get_full_name }}</td>
          <td>{{ a.moto.identificador_unico }}</td>
          <td>{{ a.moto.patente }}</td>
          <td>{{ a.fecha_asignacion }}</td>
          <td>{{ a.fecha_desasignacion }}</td>
          <td>{% if a.activa %}<span class="badge bg-success">Activa</span>{% else %}<span class="badge bg-secondary">Inactiva</span>{% endif %}</td>
          <td>
            {% if request.user.rol in 'ADMINISTRADOR|SUPERVISOR|OPERADOR' %}
              {% if a.activa %}
                <a href="{% url 'asignacion_moto_reemplazar' a.pk %}" class="btn btn-sm btn-warning">Reemplazar</a>
              {% endif %}
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="{% if puede_editar %}8{% else %}8{% endif %}" class="text-center">No hay asignaciones registrados.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Paginación -->
{% if is_paginated %}
<nav aria-label="pagination">
  <ul class="pagination mt-3">
    {% if farmacias.has_previous %}
    <li class="page-item"><a class="page-link" href="?page={{ farmacias.previous_page_number }}">Anterior</a></li>
    {% endif %}
    <li class="page-item active"><span class="page-link">{{ farmacias.number }}</span></li>
    {% if farmacias.has_next %}
    <li class="page-item"><a class="page-link" href="?page={{ farmacias.next_page_number }}">Siguiente</a></li>
    {% endif %}
  </ul>
</nav>
{% endif %}

{% endblock %}