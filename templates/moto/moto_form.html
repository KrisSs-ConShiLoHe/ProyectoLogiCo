{% extends 'base.html' %}

{% block title %}{{ titulo|default:'Moto' }} - LogiCo{% endblock %}

{% block content %}
<div class="page-title">
  <h1>{{ titulo|default:'Moto' }}</h1>
</div>

<div class="card p-4">
  <form method="post" enctype="multipart/form-data" novalidate>
    {% csrf_token %}
      {% if moto.imagen %}
        <img src="{{ moto.imagen.url }}" alt="Foto de Moto" />
      {% endif %}
    {% for field in form %}

    <div class="mb-3">
      <label class="form-label">{{ field.label }}</label>
      {{ field }}
      {% if field.errors %}<div class="invalid-feedback d-block">{{ field.errors }}</div>{% endif %}
    </div>
    {% endfor %}

    {% if mantenimiento_form %}
    {% for field in mantenimiento_form %}
    <div class="mb-3 extra-mantenimiento" style="display:none;">
        <label class="form-label">{{ field.label }}</label>
        {{ field }}
        {% if field.errors %}<div class="invalid-feedback d-block">{{ field.errors }}</div>{% endif %}
    </div>
    {% endfor %}
    {% endif %}
    <button class="btn btn-primary" type="submit">Guardar</button>
    <a class="btn btn-secondary" href="{% url 'moto_listar' %}">Cancelar</a>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const estadoSelect = document.getElementById('id_estado');

  if (!estadoSelect) return;

  const mantenimientoFields = document.querySelectorAll('.extra-mantenimiento');

  function hideFields(fields) {
    fields.forEach(f => {
      const container = f.closest('.mb-3');
      if (container) container.style.display = 'none';
      else f.style.display = 'none';
    });
  }

  function showFields(fields) {
    fields.forEach(f => {
      const container = f.closest('.mb-3');
      if (container) container.style.display = '';
      else f.style.display = '';
    });
  }

  function onEstadoChange() {
    const val = estadoSelect.value;

    if (val === 'EN_MANTENIMIENTO') {
      showFields(mantenimientoFields);
    } else {
      hideFields(mantenimientoFields);
    }
  }

  if (estadoSelect) {
    estadoSelect.addEventListener('change', onEstadoChange);
    onEstadoChange();
  }
});
</script>
{% endblock %}
